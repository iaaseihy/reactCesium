function kdbush(t,s,r,o,h){return new KDBush(t,s,r,o,h)}function KDBush(t,s,r,o,h){s=s||defaultGetX,r=r||defaultGetY,h=h||Array,this.nodeSize=o||64,this.points=t,this.ids=new h(t.length),this.coords=new h(2*t.length);for(var e=0;e<t.length;e++)this.ids[e]=e,this.coords[2*e]=s(t[e]),this.coords[2*e+1]=r(t[e]);sort(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function defaultGetX(t){return t[0]}function defaultGetY(t){return t[1]}function range(t,s,r,o,h,e,n){for(var i,u,a=[0,t.length-1,0],p=[];a.length;){var f=a.pop(),l=a.pop(),d=a.pop();if(l-d<=n)for(var c=d;c<=l;c++)i=s[2*c],u=s[2*c+1],i>=r&&i<=h&&u>=o&&u<=e&&p.push(t[c]);else{var v=Math.floor((d+l)/2);i=s[2*v],u=s[2*v+1],i>=r&&i<=h&&u>=o&&u<=e&&p.push(t[v]);var w=(f+1)%2;(0===f?r<=i:o<=u)&&(a.push(d),a.push(v-1),a.push(w)),(0===f?h>=i:e>=u)&&(a.push(v+1),a.push(l),a.push(w))}}return p}function sort(t,s,r,o,h,e){if(!(h-o<=r)){var n=Math.floor((o+h)/2);select(t,s,n,o,h,e%2),sort(t,s,r,o,n-1,e+1),sort(t,s,r,n+1,h,e+1)}}function select(t,s,r,o,h,e){for(;h>o;){if(h-o>600){var n=h-o+1,i=r-o+1,u=Math.log(n),a=.5*Math.exp(2*u/3),p=.5*Math.sqrt(u*a*(n-a)/n)*(i-n/2<0?-1:1);select(t,s,r,Math.max(o,Math.floor(r-i*a/n+p)),Math.min(h,Math.floor(r+(n-i)*a/n+p)),e)}var f=s[2*r+e],l=o,d=h;for(swapItem(t,s,o,r),s[2*h+e]>f&&swapItem(t,s,o,h);l<d;){for(swapItem(t,s,l,d),l++,d--;s[2*l+e]<f;)l++;for(;s[2*d+e]>f;)d--}s[2*o+e]===f?swapItem(t,s,o,d):swapItem(t,s,++d,h),d<=r&&(o=d+1),r<=d&&(h=d-1)}}function swapItem(t,s,r,o){swap(t,r,o),swap(s,2*r,2*o),swap(s,2*r+1,2*o+1)}function swap(t,s,r){var o=t[s];t[s]=t[r],t[r]=o}function within(t,s,r,o,h,e){for(var n=[0,t.length-1,0],i=[],u=h*h;n.length;){var a=n.pop(),p=n.pop(),f=n.pop();if(p-f<=e)for(var l=f;l<=p;l++)sqDist(s[2*l],s[2*l+1],r,o)<=u&&i.push(t[l]);else{var d=Math.floor((f+p)/2),c=s[2*d],v=s[2*d+1];sqDist(c,v,r,o)<=u&&i.push(t[d]);var w=(a+1)%2;(0===a?r-h<=c:o-h<=v)&&(n.push(f),n.push(d-1),n.push(w)),(0===a?r+h>=c:o+h>=v)&&(n.push(d+1),n.push(p),n.push(w))}}return i}function sqDist(t,s,r,o){var h=t-r,e=s-o;return h*h+e*e}KDBush.prototype={range:function(t,s,r,o){return range(this.ids,this.coords,t,s,r,o,this.nodeSize)},within:function(t,s,r){return within(this.ids,this.coords,t,s,r,this.nodeSize)}};export default kdbush;